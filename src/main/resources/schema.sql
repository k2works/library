DROP TABLE IF EXISTS 会員,本,蔵書,貸出可能,貸出,返却,予約,予約取消,取置;
DROP SEQUENCE IF EXISTS 貸出ID;
DROP SEQUENCE IF EXISTS 予約ID;

-- スキーマとオブジェクトをリセット
DROP SCHEMA IF EXISTS 蔵書 CASCADE ;
CREATE SCHEMA 蔵書;

DROP SCHEMA IF EXISTS 会員 CASCADE;
CREATE SCHEMA 会員;

DROP SCHEMA IF EXISTS 貸出 CASCADE;
CREATE SCHEMA 貸出;

DROP SCHEMA IF EXISTS 予約 CASCADE;
CREATE SCHEMA 予約;

-- 会員スキーマ
CREATE TABLE 会員.登録 (
    会員番号 INTEGER PRIMARY KEY,
    氏名 VARCHAR(40) NOT NULL,
    会員種別 VARCHAR(2) NOT NULL,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 蔵書スキーマ
CREATE TABLE 蔵書.本 (
    本番号 INTEGER PRIMARY KEY,
    タイトル VARCHAR(40) NOT NULL,
    著者 VARCHAR(40) NOT NULL,
    本種別 VARCHAR(8) NOT NULL,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 蔵書.登録 (
    蔵書番号 VARCHAR(40) PRIMARY KEY,
    本番号 INTEGER NOT NULL REFERENCES 蔵書.本,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 蔵書.貸出可能 (
    蔵書番号 VARCHAR(40) PRIMARY KEY REFERENCES 蔵書.登録,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 蔵書.取置中 (
    蔵書番号 VARCHAR(40) PRIMARY KEY REFERENCES 蔵書.登録,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 貸出スキーマ
CREATE SEQUENCE 貸出.貸出番号;

CREATE TABLE 貸出.貸出履歴 (
    貸出番号 INTEGER PRIMARY KEY,
    会員番号 INTEGER NOT NULL REFERENCES 会員.登録,
    蔵書番号 VARCHAR(40) NOT NULL REFERENCES 蔵書.登録,
    貸出日 DATE NOT NULL,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 貸出.返却履歴 (
    貸出番号 INTEGER PRIMARY KEY REFERENCES 貸出.貸出履歴,
    返却日 DATE NOT NULL,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 予約スキーマ
CREATE SEQUENCE 予約.予約番号;

CREATE TABLE 予約.予約履歴 (
    予約番号 INTEGER PRIMARY KEY,
    会員番号 INTEGER NOT NULL REFERENCES 会員.登録,
    本番号 INTEGER NOT NULL REFERENCES 蔵書.本,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 予約.取置依頼中 (
  予約番号 INTEGER PRIMARY KEY REFERENCES 予約.予約履歴,
  登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 予約.取消履歴 (
    予約番号 INTEGER PRIMARY KEY REFERENCES 予約.予約履歴,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE 予約.取置履歴 (
    予約番号 INTEGER PRIMARY KEY REFERENCES 予約.予約履歴,
    蔵書コード VARCHAR(40) NOT NULL,
    取置日 DATE NOT NULL,
    登録日時 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
