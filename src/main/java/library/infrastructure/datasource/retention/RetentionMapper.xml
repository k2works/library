<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="library.infrastructure.datasource.retention.RetentionMapper">

    <insert id="insert取置依頼中">
        INSERT INTO 予約.取置依頼中(予約番号)
        VALUES (#{value})
    </insert>

    <delete id="delete取置依頼中">
        DELETE FROM 予約.取置依頼中
        WHERE 予約番号 = #{value}
    </delete>

    <insert id="insert取置履歴">
        INSERT INTO 予約.取置履歴(予約番号, 蔵書番号, 取置日)
        VALUES (#{reservationNumber.value}, #{itemNumber.value}, #{retainedDate.value})
    </insert>

    <insert id="insert取置済">
        INSERT INTO 予約.取置済(予約番号, 蔵書番号, 取置日)
        VALUES (#{reservationNumber.value}, #{itemNumber.value}, #{retainedDate.value})
    </insert>

    <delete id="delete取置済">
        DELETE FROM 予約.取置済 WHERE 蔵書番号 = #{value}
    </delete>

    <resultMap id="取置済" type="library.domain.model.reservation.retention.Retained">
        <association property="reservation"
                     column="reservation"
                     select="library.infrastructure.datasource.reservation.ReservationMapper.selectReservation"/>
    </resultMap>

    <select id="selectAll取置済" resultMap="取置済">
        SELECT
            蔵書番号 AS "itemNumber.value",
            予約番号 AS "reservation",
            取置日 AS "retainedDate.value"
        FROM 予約.取置済
        ORDER BY 取置日
    </select>

    <select id="select取置済" resultMap="取置済">
        SELECT
            蔵書番号 AS "itemNumber.value",
            予約番号 AS "reservation",
            取置日 AS "retainedDate.value"
        FROM 予約.取置済
        WHERE 蔵書番号 = #{value}
    </select>
</mapper>